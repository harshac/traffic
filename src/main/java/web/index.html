<!DOCTYPE html>
<meta charset="utf-8">
<style>

    .node {
        fill: #ccc;
        stroke: #000;
    }

</style>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>
    var YELLOW = "#ffd700";
    var RED = "#ff0000";
    var GREEN = "#008000";
    var graph = {
        nodes: d3.range(6).map(Object),
        links: [
            {source: 0, target: 1, id: "0-1"},
            {source: 1, target: 2, id: "1-2"},
            {source: 1, target: 3, id: "1-3"},
            {source: 2, target: 5, id: "2-5"},
            {source: 3, target: 5, id: "3-5"},
            {source: 4, target: 5, id: "4-5"},
            {source: 0, target: 4, id: "0-4"}
        ]
    };

    var width = 960,
            height = 500;

    var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

    var force = d3.layout.force()
            .nodes(graph.nodes)
            .links(graph.links)
            .size([width, height])
            .charge(-1900)
            .linkDistance(200)
            .on("tick", tick)
            .start();

    var link = svg.selectAll(".link")
            .data(graph.links)
            .enter().append("line")
            .attr("class", "link")
            .attr("stroke", "#0ff")
            .attr("stroke-width", 3);

    var node = svg.selectAll(".node")
            .data(graph.nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", 7.5);

    function tick() {
        link.attr("x1", function (d) {
            return d.source.x;
        })
                .attr("y1", function (d) {
                    return d.source.y;
                })
                .attr("x2", function (d) {
                    return d.target.x;
                })
                .attr("y2", function (d) {
                    return d.target.y;
                })
                .attr("id", function (d) {
                    return d.id
                });

        node.attr("cx", function (d) {
            return d.x;
        })
                .attr("cy", function (d) {
                    return d.y;
                });
    }


    d3.json("sampledata.json", function (data) {
        console.log(data)
        data1 = data[0];

        data1.forEach(function (jsonData) {
            var roadTrafficRatio = jsonData.flow / jsonData.capacity;
            var roadId = jsonData.id
            console.log("Road Traffic on " + jsonData.id + " is proportionate to " + roadTrafficRatio);
            var linkElement = findElement(d3.selectAll(".link")[0], roadId);
            linkElement.setAttribute("stroke-width", (2 + 2 * roadTrafficRatio));
            if (roadTrafficRatio > 0.5 && roadTrafficRatio < 1) {
                linkElement.setAttribute("stroke", YELLOW);
            } else if (roadTrafficRatio < 0.5) {
                linkElement.setAttribute("stroke", GREEN);
            }
            else {
                linkElement.setAttribute("stroke", RED);
            }


        });

    });

    function findElement(elements, id) {
        var selectedElement;
        elements.forEach(function (element) {
            if (element.id == id) {
                selectedElement = element;
                return;
            }
        })
        return selectedElement;
    }
    var data1;
</script>
